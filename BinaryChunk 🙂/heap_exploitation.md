## Heap Exploitation

- There are various different techniques that are used to attack the heap and make it do what is was not intended to do.
- Some of the Heap Exploitation techniques include the following:

```
+--------------------+----------------------------+-----------------------+
|   Bug Used         |  Bin Attack                |   House               |
+--------------------+----------------------------+-----------------------+
|                    |  Fast Bin Attack           |   House of Spirit     |
|   Double Free      |  tcache attack             |   House of Lore       |
|   Heap Overflow    |  Unsorted Bin Attck        |   House of Force      |
|   Use After Free   |  Small / Large Bin Attck   |   House of Einherjar  |
|                    |  Unsafe Unlink             |   House of Orange     |
+--------------------+----------------------------+-----------------------+

```
- The bugs are some of the common bugs by the programmer that lead to the different heap and house attacks.

## Double Free

- This is a type of bug that allows the attacker to free more than 2 chunks.
- Therefore this is used to enable the attacker edit the contents of a freed chunks
- Therefore this can lead to all the other attacks.

```
#include <stdio.h>
#include <stdlib.h>

int main(int argc, char **argv){
  char *a, *b, *c;
  a = (char *) malloc(0x10);
  b = (char *) malloc(0x10);
  c = (char *) malloc(0x10);
   
  free(a);
  free(b);
  free(a); // Double Free bug =)
}
```

## Heap Overflow
- This is a type of bug where a user or an attacker can write beyond the buffer allocated on the heap.
- This can therefore enable a malicious user to overflow into another chunk and control the 
contents of the chunks metadata.
- This can lead to a fake heap consolidation, fastbin attack etc..
- The following is an example of code that is vulnerable to a heap overflow bug.

```
#include <stdio.h>
#include <stdlib.h>

int main(int argc, char **argv){
  char *a;*b;
  a = (char *) malloc(0x10);
  b = (char *) malloc(0x10);
    
  printf("What is your name: ");
  gets(a); // This will threfore lead to a heap overflow and let the attacker overflow into chunk (b)
  return 0;
}
```

## Use After Free 

- This is a bug where on freeing a chunk in memory the pointer still points to this region.
- This therefore can be used to attack the heap by controlling the fd and the bk pointers or 
by leaking addresses.
- The following is a POC used to demonstrate a UAF bug


```
#include <stdio.h>
#include <stdlib.h>

int main(int argc, char **argv){
  char *a;
  a = (char *) malloc(0x10);
  printf("What is your name: ");
  read(0, a, 0x10); // No Heap oveflow =)
  printf("Bye %s !\n", a);
  
  free(a);
  printf("%s\n", a); // We still used the pointer (a) even after freeing the memory it points to. Therefore UAF
  a = NULL; // This is used to prevent a UAF bug because the pointer now pointers to a NULL value =)
  return 0;
}
```
